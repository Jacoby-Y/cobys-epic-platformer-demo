var st=Object.defineProperty;var rt=(t,e,n)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>(rt(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const u={listeners:{},case_listeners:{},listen(t,e){return Array.isArray(this.listeners[t])||(this.listeners[t]=[]),this.listeners[t].push(e),function(){var n;(n=u.listeners[t])==null||n.splice(u.listeners[t].indexOf(e))}},listenFor(t,e,n){return this.case_listeners[t]==null&&(this.case_listeners[t]={}),this.case_listeners[t][e]==null&&(this.case_listeners[t][e]=[]),this.case_listeners[t][e].push(n),function(){var i;(i=u.case_listeners[t][e])==null||i.splice(u.case_listeners[t][e].indexOf(n)),u.case_listeners[t][e].length==0&&delete u.case_listeners[t][e]}},emit(t,e=null){var r;const n=this.listeners[t],i=this.case_listeners[t];if(n!=null)for(let s=0;s<n.length;s++){const o=i==null?void 0:i[e];if(o!=null){let l=!1;for(let c=0;c<o.length;c++)o[c]()===!0&&(l=!0);if(l)continue}(r=n[s])==null||r.call(n,e)}}};let h,f,p={w:0,h:0,center:{x:0,y:0}},J=!0,S=t=>(t!=null&&(J=t),(J&&h)??!1),d=1,ot="#263238",M=0,A=0;function lt(t){if(t==null){ct();return}f=t,h=t.getContext("2d"),h.lineCap="round",M=f.width,A=f.height,p.w=M,p.h=A,p.center.x=M/2,p.center.y=A/2,at(),u.emit("SetCanvas",f)}function ct(t=!1){t&&(f==null||f.parentElement.removeChild(f)),h=null,f=null}function at(t=d){d=t,f.width=M*t,f.height=A*t,u.emit("SetScale",d)}function ft(){return f!=null}function ut(t=1080,e=1080,n=document.body){const i=document.createElement("canvas");i.width=t,i.height=e,n.appendChild(i),lt(i)}function $(t,e,n,i,r){S()&&(H(r),h.fillRect(t*d,e*d,n*d,i*d))}function ht(t=!1){S()&&(t?h.clearRect(0,0,p.w,p.h):$(0,0,p.w,p.h,ot))}function dt(t,e,n,i="white",r=30,s="Arial",o=!0){if(S()){if(H(i),mt(`${Math.ceil(r*d)}px ${s}`),o){const l=h.measureText(t).width;e-=l/2}h.fillText(t,e*d,n*d)}}let I="";function H(t){S()&&I!=t&&(I=t,h.fillStyle=t)}function mt(t){S()&&h.font!=t&&(h.font=t)}const yt={all_jobs:[],add(t,e){this.all_jobs.push({wait_time:t,callback:e})},runJobs(t){for(let e=this.all_jobs.length-1;e>=0;e--){const n=this.all_jobs[e];if(n.wait_time-=t,n.wait_time<=0){const i=n.callback();typeof i=="number"?n.wait_time=i:this.all_jobs.splice(e,1)}}}},N={funcs:[],add(...t){this.funcs.push(...t)},run(){for(let t=0;t<this.funcs.length;t++){const e=this.funcs[t];e==null||e()}}};let P=-1;const k=[...Array(60)].fill(0);let E=0,U=0,T=0;function V(t=performance.now()){P<0&&(P=t);let e=t-P;P=t,T=e,N.run(),k[E]=e,E=(E+1)%k.length,E==0&&(U=Math.round(1e3/(k.reduce((n,i)=>n+i)/k.length))),yt.runJobs(T),requestAnimationFrame(V)}function gt(){ft()||console.warn("startGame() is running when the canvas isn't set yet!"),V()}const X={get fps(){return U},get delta(){return T}};let Q=0;const F={};let L={};function pt(...t){for(let e=0;e<t.length;e++){const n=t[e],i=Object.getPrototypeOf(n).constructor.name;F[i]==null&&(F[i]=[]),n._id=Q,F[i].push(n)}return L={},Q++}const _t=t=>t.map(e=>[]);function K(...t){if(t.length==0)throw"<queryEntities()> Must give at least one param";const e=typeof t[0]=="string"?t:t.map(s=>s.name);if(e.length==1)return[F[e[0]]??[]];const n=e.toSorted().join("|");if(L[n]!=null){const s=L[n];return e.map(o=>s[o])}const i=e.map(s=>F[s]??null);if(i.includes(null))return _t(e);const r=i.map(s=>[...s]);return Y(r),L[n]=Object.fromEntries(e.map((s,o)=>[s,r[o]])),r}function Y(t,e=!1){const n=t.reduce((o,l)=>l.length<o.length?l:o),i=new Set(n.map(o=>o._id));for(let o=0;o<t.length;o++)if(t[o]!=n)for(let l=0;l<t[o].length;l++){const c=t[o][l];i.has(c._id)||(t[o].splice(l,1),l--)}let r=!0,s=t[0].length;for(let o=0;o<t.length;o++)if(t[o].length!=s){r=!1;break}if(!r&&!e)return Y(t,!1)}const O={},Z={};function w(t,e){const i=t.map(r=>r.name).join("|");O[i]==null&&(O[i]=[]),O[i].push(e)}function wt(){const t=Object.keys(O).map(n=>n.split("|")),e=Object.keys(Z).map(n=>n.split("|"));for(let n=0;n<t.length;n++){const i=t[n],r=K(...i),s=i.join("|");xt(s,r)}for(let n=0;n<e.length;n++){const i=e[n],r=K(...i),s=i.join("|");bt(s,r)}}function xt(t,e){if(e[0].length==0)return;const n=O[t]??[];for(let i=0;i<n.length;i++){const r=n[i];for(let s=0;s<e[0].length;s++){let o=[];for(let l=0;l<e.length;l++)o.push(e[l][s]);r(...o)}}}function bt(t,e){if(e[0].length==0)return;const n=Z[t]??[];for(let i=0;i<n.length;i++){const r=n[i];r(...e)}}class C{constructor(e=-1){m(this,"_id");this._id=e}}class _ extends C{constructor(n=0,i=0){super();m(this,"x");m(this,"y");this.x=n,this.y=i}}class z extends C{constructor(n=0,i=0,r=0,s=1,o=1){super();m(this,"vx");m(this,"vy");m(this,"gravity");m(this,"drag_x");m(this,"drag_y");this.vx=n,this.vy=i,this.gravity=r,this.drag_x=s,this.drag_y=o}addGravity(){this.vy+=this.gravity}movePosition(n,i=1){n.x+=this.vx*i,n.y+=this.vy*i,this.vx*=this.drag_x,this.vy*=this.drag_y}addForce(n,i){this.vx+=Math.cos(n)*i,this.vy+=Math.sin(n)*i}}class v extends C{constructor(e,n,i="#FF0000"){super(),this.w=e,this.h=n,this.color=i}draw(e){$(e.x,e.y,this.w,this.h,this.color)}boxCollision(e,n,i){const r=e.x,s=e.x+this.w,o=e.y,l=e.y+this.h,c=n.x,x=n.x+i.w,y=n.y,b=n.y+i.h;return r<x&&s>c&&o<b&&l>y}}class tt extends C{constructor(){super()}}class G extends C{constructor(e){super(),this.name=e}}class R extends C{constructor(e,n=0,i=!0){super(),this.max_time=e,this.time=n,this.increasing=i}addTime(e){this.increasing?(this.time+=e,this.time>=this.max_time&&(this.time=this.max_time,this.increasing=!1)):(this.time-=e,this.time<=0&&(this.time=0,this.increasing=!0))}get fullPercentage(){return this.time/this.max_time}get halfPercentage(){return this.increasing?this.fullPercentage:1-this.fullPercentage}}const W={true:!0,false:!1,null:null};function vt(t,e,n=!0){const i=j(e,`
`).map(o=>o.slice(0,2)=="//"?"":j(o,"//")[0]).filter(o=>o).join("");if(i=="")throw"<compileCeon()> Can't compile CEON; string is empty";const r=j(i,"}{").map(o=>o[0]=="{"?o.slice(1):o[o.length-1]=="}"?o.slice(0,-1):o),s=[];for(const o of r){const l=j(o,")"),c=[];for(const x of l){const[y,b]=j(x,"("),g=t[y];if(g==null)throw`<compileCeon()> Class "${y}" not found in class set`;if(typeof g!="function")throw`<compileCeon()> Class "${y}" is found, but is not a constructor function`;const it=(b??"").split(",").map(a=>a.trim()).map(a=>(a=a.trim(),a[0]=='"'?a.slice(1,-1):W[a]!==void 0?W[a]:isFinite(parseFloat(a))?parseFloat(a):null)).filter(a=>a);c.push(new g(...it))}s.push(c)}return n&&jt(s),s}async function Ct(t,e,n=!0){const i=await fetch(e);if(!i.ok)throw`Can't load entities from "${e}"`;const r=await i.text();vt(t,r,n)}function j(t,e){let n=[""],i=0,r=!1;for(let s=0;s<t.length;s++){if(t[s]=='"')r=!r;else if(!r&&t.slice(s,s+e.length)==e){s+=e.length-1,i++,n[i]="";continue}n[i]+=t[s]}return n.map(s=>s.trim()).filter(s=>s)}function jt(t){for(const e of t)pt(...e)}const et={};function Ft(t){const e=Object.getPrototypeOf(t).constructor.name;if(e=="Object")throw"<setScoreboard()> must be given an instance of a class, not an object literal";et[e]=t}function nt(t){const e=typeof t=="string"?t:t.name;return et[e]??null}class B{constructor(e=0,n=0){this.horz=e,this.vert=n}}Ft(new B);w([_,v],(t,e)=>{e.draw(t)});w([_,v,G],(t,e,n)=>{dt(n.name,t.x+e.w/2,t.y-35,"#FFFFFF",20)});w([_,z],(t,e)=>{e.movePosition(t,X.delta),e.addGravity(),t.y>2e3&&(t.x=500,t.y=500)});w([_,v,tt],(t,e,n)=>{const i=K(_,v,z);for(let r=0;r<i[0].length;r++){const[s,o,l]=[i[0][r],i[1][r],i[2][r]];if(e.boxCollision(t,s,o)){const c=Math.abs(t.x-(s.x+o.w)),x=Math.abs(t.x+ +e.w-s.x),y=Math.abs(s.y+o.h-t.y),b=Math.abs(t.y+e.h-s.y),g=Math.min(x,c,y,b);g==y?(l.vy=0,s.y=t.y-o.h):g==b?(l.vy=.001,s.y=t.y+e.h):g==x?(l.vx=0,s.x=t.x+e.w):g==c&&(l.vx=0,s.x=t.x-o.w)}}});w([z,G],(t,e)=>{const{horz:n,vert:i}=nt(B);t.vx+=n*.1,t.vy==0&&i<0&&(t.vy-=2)});w([_,v,G,R],(t,e,n,i)=>{$(t.x+(e.w-10)*i.fullPercentage,t.y-15,10,10,e.color),$(t.x+(e.w-10)*i.halfPercentage,t.y-30,10,10,e.color)});w([R],t=>{t.addTime(X.delta)});function D(t=0,e=1,n=2){return e<t?t:e>n?n:e}const q={};window.onkeydown=({key:t})=>{q[t.toLowerCase()]=!0,u.emit("KeyEvent",q)};window.onkeyup=({key:t})=>{q[t.toLowerCase()]=!1,u.emit("KeyEvent",q)};u.listen("KeyEvent",t=>{let e=0,n=0;t.a&&(e-=1),t.d&&(e+=1),t.w&&(n-=1),t.s&&(n+=1);const i=nt(B);i.horz=D(-1,e,1),i.vert=D(-1,n,1)});ut(1e3,800,document.body);N.add(ht);N.add(wt);gt();const Ot={Position:_,RigidBody:z,Collider:tt,Box:v,Player:G,Animation:R};Ct(Ot,"./ceon/entities.ceon");
