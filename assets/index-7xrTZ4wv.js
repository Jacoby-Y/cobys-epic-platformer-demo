var et=Object.defineProperty;var nt=(t,e,n)=>e in t?et(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var h=(t,e,n)=>(nt(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const u={listeners:{},case_listeners:{},listen(t,e){return Array.isArray(this.listeners[t])||(this.listeners[t]=[]),this.listeners[t].push(e),function(){var n;(n=u.listeners[t])==null||n.splice(u.listeners[t].indexOf(e))}},listenFor(t,e,n){return this.case_listeners[t]==null&&(this.case_listeners[t]={}),this.case_listeners[t][e]==null&&(this.case_listeners[t][e]=[]),this.case_listeners[t][e].push(n),function(){var s;(s=u.case_listeners[t][e])==null||s.splice(u.case_listeners[t][e].indexOf(n)),u.case_listeners[t][e].length==0&&delete u.case_listeners[t][e]}},emit(t,e=null){var o;const n=this.listeners[t],s=this.case_listeners[t];if(n!=null)for(let i=0;i<n.length;i++){const r=s==null?void 0:s[e];if(r!=null){let l=!1;for(let c=0;c<r.length;c++)r[c]()===!0&&(l=!0);if(l)continue}(o=n[i])==null||o.call(n,e)}}};let p,a,m={w:0,h:0,center:{x:0,y:0}},$=!0,K=t=>(t!=null&&($=t),($&&p)??!1),g=1,st="#263238",E=0,F=0;function it(t){if(t==null){ot();return}a=t,p=t.getContext("2d"),p.lineCap="round",E=a.width,F=a.height,m.w=E,m.h=F,m.center.x=E/2,m.center.y=F/2,rt(),u.emit("SetCanvas",a)}function ot(t=!1){t&&(a==null||a.parentElement.removeChild(a)),p=null,a=null}function rt(t=g){g=t,a.width=E*t,a.height=F*t,u.emit("SetScale",g)}function lt(){return a!=null}function ct(t=1080,e=1080,n=document.body){const s=document.createElement("canvas");s.width=t,s.height=e,n.appendChild(s),it(s)}function W(t,e,n,s,o){K()&&(at(o),p.fillRect(t*g,e*g,n*g,s*g))}function ft(t=!1){K()&&(t?p.clearRect(0,0,m.w,m.h):W(0,0,m.w,m.h,st))}let B="";function at(t){K()&&B!=t&&(B=t,p.fillStyle=t)}const ut={all_jobs:[],add(t,e){this.all_jobs.push({wait_time:t,callback:e})},runJobs(t){for(let e=this.all_jobs.length-1;e>=0;e--){const n=this.all_jobs[e];if(n.wait_time-=t,n.wait_time<=0){const s=n.callback();typeof s=="number"?n.wait_time=s:this.all_jobs.splice(e,1)}}}},N={funcs:[],add(...t){this.funcs.push(...t)},run(){for(let t=0;t<this.funcs.length;t++){const e=this.funcs[t];e==null||e()}}};let O=-1;const S=[...Array(60)].fill(0);let k=0,D=0,z=0;function H(t=performance.now()){O<0&&(O=t);let e=t-O;O=t,z=e,N.run(),S[k]=e,k=(k+1)%S.length,k==0&&(D=Math.round(1e3/(S.reduce((n,s)=>n+s)/S.length))),ut.runJobs(z),requestAnimationFrame(H)}function ht(){lt()||console.warn("startGame() is running when the canvas isn't set yet!"),H()}const dt={get fps(){return D},get delta(){return z}};let J=0;const x={},q={};function yt(...t){for(let e=0;e<t.length;e++){const n=t[e],s=Object.getPrototypeOf(n).constructor.name;x[s]==null&&(x[s]=[]),n._id=J,x[s].push(n)}return J++}const mt=t=>t.map(e=>[]);function G(...t){if(t.length==0)throw"<queryEntities()> Must give at least one param";const e=typeof t[0]=="string"?t:t.map(i=>i.name);if(e.length==1)return[x[e[0]]??[]];const n=e.toSorted().join("|");if(q[n]!=null){const i=q[n];return e.map(r=>i[r])}const s=e.map(i=>x[i]??null);if(s.includes(null))return mt(e);const o=s.map(i=>[...i]);return T(o),q[n]=Object.fromEntries(e.map((i,r)=>[i,o[r]])),o}function T(t,e=!1){const n=t.reduce((r,l)=>l.length<r.length?l:r),s=new Set(n.map(r=>r._id));for(let r=0;r<t.length;r++)if(t[r]!=n)for(let l=0;l<t[r].length;l++){const c=t[r][l];s.has(c._id)||(t[r].splice(l,1),l--)}let o=!0,i=t[0].length;for(let r=0;r<t.length;r++)if(t[r].length!=i){o=!1;break}if(!o&&!e)return T(t,!1)}const v={},U={};function L(t,e){const s=t.map(o=>o.name).join("|");v[s]==null&&(v[s]=[]),v[s].push(e)}function gt(){const t=Object.keys(v).map(n=>n.split("|")),e=Object.keys(U).map(n=>n.split("|"));for(let n=0;n<t.length;n++){const s=t[n],o=G(...s),i=s.join("|");pt(i,o)}for(let n=0;n<e.length;n++){const s=e[n],o=G(...s),i=s.join("|");_t(i,o)}}function pt(t,e){if(e[0].length==0)return;const n=v[t]??[];for(let s=0;s<n.length;s++){const o=n[s];for(let i=0;i<e[0].length;i++){let r=[];for(let l=0;l<e.length;l++)r.push(e[l][i]);o(...r)}}}function _t(t,e){if(e[0].length==0)return;const n=U[t]??[];for(let s=0;s<n.length;s++){const o=n[s];o(...e)}}class j{constructor(e=-1){h(this,"_id");this._id=e}}class C extends j{constructor(n=0,s=0){super();h(this,"x");h(this,"y");this.x=n,this.y=s}}class A extends j{constructor(n=0,s=0,o=0,i=1,r=1){super();h(this,"vx");h(this,"vy");h(this,"gravity");h(this,"drag_x");h(this,"drag_y");this.vx=n,this.vy=s,this.gravity=o,this.drag_x=i,this.drag_y=r}addGravity(){this.vy+=this.gravity}movePosition(n,s=1){n.x+=this.vx*s,n.y+=this.vy*s,this.vx*=this.drag_x,this.vy*=this.drag_y}addForce(n,s){this.vx+=Math.cos(n)*s,this.vy+=Math.sin(n)*s}}class M extends j{constructor(e,n,s="#FF0000"){super(),this.w=e,this.h=n,this.color=s}draw(e){W(e.x,e.y,this.w,this.h,this.color)}boxCollision(e,n,s){const o=e.x,i=e.x+this.w,r=e.y,l=e.y+this.h,c=n.x,_=n.x+s.w,d=n.y,w=n.y+s.h;return o<_&&i>c&&r<w&&l>d}}class V extends j{constructor(){super()}}class X extends j{constructor(e){super(),this.name=e}}const I={true:!0,false:!1,null:null};function wt(t,e,n=!0){const s=b(e,`
`).map(r=>b(r,"//")[0]).filter(r=>r).join("");if(s=="")throw"<compileCeon()> Can't compile CEON; string is empty";const o=b(s,"}{").map(r=>r[0]=="{"?r.slice(1):r[r.length-1]=="}"?r.slice(0,-1):r),i=[];for(const r of o){const l=b(r,")"),c=[];for(const _ of l){const[d,w]=b(_,"("),y=t[d];if(y==null)throw`<compileCeon()> Class "${d}" not found in class set`;if(typeof y!="function")throw`<compileCeon()> Class "${d}" is found, but is not a constructor function`;const tt=(w??"").split(",").map(f=>f.trim()).map(f=>(f=f.trim(),f[0]=='"'?f.slice(1,-1):I[f]!==void 0?I[f]:isFinite(parseFloat(f))?parseFloat(f):null)).filter(f=>f);c.push(new y(...tt))}i.push(c)}return n&&xt(i),i}async function bt(t,e,n=!0){const s=await fetch(e);if(!s.ok)throw`Can't load entities from "${e}"`;const o=await s.text();wt(t,o,n)}function b(t,e){let n=[""],s=0,o=!1;for(let i=0;i<t.length;i++){if(t[i]=='"')o=!o;else if(!o&&t.slice(i,i+e.length)==e){i+=e.length-1,s++,n[s]="";continue}n[s]+=t[i]}return n.map(i=>i.trim()).filter(i=>i)}function xt(t){for(const e of t)yt(...e)}const Y={};function vt(t){const e=Object.getPrototypeOf(t).constructor.name;if(e=="Object")throw"<setScoreboard()> must be given an instance of a class, not an object literal";Y[e]=t}function Z(t){const e=typeof t=="string"?t:t.name;return Y[e]??null}class R{constructor(e=0,n=0){this.horz=e,this.vert=n}}vt(new R);L([C,M],(t,e)=>{e.draw(t)});L([C,A],(t,e)=>{e.movePosition(t,dt.delta),e.addGravity(),t.y>2e3&&(t.x=500,t.y=500)});L([C,M,V],(t,e,n)=>{const s=G(C,M,A);for(let o=0;o<s[0].length;o++){const[i,r,l]=[s[0][o],s[1][o],s[2][o]];if(e.boxCollision(t,i,r)){const c=Math.abs(t.x-(i.x+r.w)),_=Math.abs(t.x+ +e.w-i.x),d=Math.abs(i.y+r.h-t.y),w=Math.abs(t.y+e.h-i.y),y=Math.min(_,c,d,w);y==d?(l.vy=0,i.y=t.y-r.h):y==w?(l.vy=0,i.y=t.y+e.h):y==_?(l.vx=0,i.x=t.x+e.w):y==c&&(l.vx=0,i.x=t.x-r.w)}}});L([A,X],(t,e)=>{const{horz:n,vert:s}=Z(R);t.vx+=n*.1,t.vy==0&&s<0&&(t.vy-=2)});function Q(t=0,e=1,n=2){return e<t?t:e>n?n:e}const P={};window.onkeydown=({key:t})=>{P[t.toLowerCase()]=!0,u.emit("KeyEvent",P)};window.onkeyup=({key:t})=>{P[t.toLowerCase()]=!1,u.emit("KeyEvent",P)};u.listen("KeyEvent",t=>{let e=0,n=0;t.a&&(e-=1),t.d&&(e+=1),t.w&&(n-=1),t.s&&(n+=1);const s=Z(R);s.horz=Q(-1,e,1),s.vert=Q(-1,n,1)});ct(1e3,800,document.body);N.add(ft);N.add(gt);ht();const Ct={Position:C,RigidBody:A,Collider:V,Box:M,Player:X};bt(Ct,"./ceon/entities.ceon");
